<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Facetime Me!</title>
  <meta name="description" content="Facetime Me!">
  <meta name="author" content="Dollop Labs">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <link rel="stylesheet" href="/static/css/style.css?v=2">
  <link rel="stylesheet" href="/static/css/960.css?v=2">
  <link rel="stylesheet" href="/static/css/ui-lightness/jquery-ui-1.8.7.custom.css?v=2">
</head>

<body>
    <div id="fb-root"></div>
    <script>
      window.fbAsyncInit = function() {
        FB.init({appId: '{{ facebook_app_id }}', status: true, cookie: true, xfbml: true});
        FB.Event.subscribe('{% if current_user %}auth.logout{% else %}auth.login{% endif %}', function(response) {
          window.location.reload();
        });
      };
      (function() {
        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
        e.async = true;
        document.getElementById('fb-root').appendChild(e);
      }());
      
    </script>
    
    <div class="container_24">
        <div class="grid_12">
            <!-- <img src="/static/img/logo.png" /> -->
            Facetime Me Logo<br />
            Facetime Your Facebook Friends!
        </div>
        <div class="grid_12" style="text-align:center;">
            <div style="padding-top:40px;">
                {% if current_user %}
                  <p><a href="{{ current_user.profile_url }}"><img src="http://graph.facebook.com/{{ current_user.id }}/picture?type=square"/></a></p>
                  <p>Hello, {{ current_user.name|escape }}</p>
                  
                  <p>Your Facetime Email: <span id="facetime-email-form" style="{% if current_user.facetime_email %}display:none;{% endif %}"><input type="text" name="email" id="email"/><input type="submit" id="submit" /></span><span id="facetime-email" style="{% if not current_user.facetime_email %}display:none;{% endif %}"><span id="facetime-email-text">{{ current_user.facetime_email|escape }}</span>&nbsp;<a href="#" id="update-email">Update</a></span></p>
                {% endif %}
                
                <fb:login-button autologoutlink="true"></fb:login-button>
            </div>
        </div>
        
        <div class="clear"></div>
        <br />
        
        <div class="grid_24">
            {% if current_user %}
                      {% if facetime_friends %}
                        <div id="facetime-friend-list">
                            {% for f in facetime_friends %}
                                {% if f.facetime_email %}
                                    <div><img src="{{ f.picture }}"/><a href="{{ f.profile_url }}">{{ f.name }}</a>&nbsp;<a href="facetime://{{ f.facetime_email|escape }}">Call {{ f.first_name }}</a></div>
                                {% endif %}
                            {% endfor %}
                        </div>
                      {% else %}
                        None of your friends are here... tell them to sign up!
                      {% endif %}
                    <!-- <input id="add_friends" placeholder="Type a friend's name"/> -->
            {% endif %}             

        </div>
        
        <div class="grid_24">
            {% block footer %}
                Brought to you by Dollop Labs
            {% endblock %}
        </div>
    </div>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
  <script>!window.jQuery && document.write('<script src="{{ media_url }}js/jquery-1.5.0.min.js"><\/script>')</script>
  <!-- <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script> -->
  <!-- <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>  -->
  
  {% if current_user %}
      <script type="text/javascript">
        $('#update-email').click(function(){
            $('#facetime-email').hide();
            $('#facetime-email-form').show();            
        });
        
        $('#submit').click(function () {		
            var email = $('input[name=email]');
            if (email.val()=='') {
                return false;
            }
            
            $('#facetime-email-form').hide();
                        
            $.getJSON('/ajax/update_email', {email:email.val()}, function(data) {
                $('#facetime-email-text').html(data.email);
                $('#facetime-email').show();
            }).error(function() { $('#facetime-email-form').show(); });
            
            return true;
        });
      </script>
  {% endif %}

  <!-- <script>
   var _gaq = [['_setAccount', 'XXXXXXXX'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script> -->
  
</body>
</html>
